<div>
  <h1>MisinfoMe</h1>
  <p>It is hard to distinguish fact from fiction on social media.</p>
  <p>Assess your Twitter profile, we will verify if your posts contain some detected misinformation.</p>
  <mat-card>
    <form #main_form="ngForm" (ngSubmit)="onSubmit()">
      <mat-form-field>
        <mat-label for="screen_name">Your Twitter screen name</mat-label>
        <input matInput placeholder="Twitter screen name" required="true" [formControl]="screen_name" pattern="[a-zA-Z0-9_]+">
        <mat-error *ngIf="!screen_name.valid">{{getErrorMessage()}}</mat-error>
      </mat-form-field>
      <button type="submit" mat-raised-button color="accent" [disabled]="!screen_name.valid">Assess</button>
      <p>Your screen name is the part after the '@', e.g. <i>realDonaldTrump</i></p>
    </form>
  </mat-card>
  <p></p>
  <!-- <app-graph [data]="data_for_graph"></app-graph> -->
  <div *ngIf="show_you">
    <mat-card>
      <mat-spinner *ngIf="loading_you" class="center"></mat-spinner>
      <div *ngIf="error_you">Error! Something is wrong in the communication with the backend!</div>
      <div *ngIf="!loading_you && !error_you" [@enterAnimation]>
        <h3>You - <a href="https://twitter.com/{{result_you.screen_name}}" target="_blank">@{{result_you.screen_name}}</a></h3>
        <div>We looked at {{result_you.tweets_cnt}} tweets from your profile.</div>
        <div *ngIf="result_you.score >= 50" class="good">Your score is good.</div>
        <div *ngIf="result_you.score < 50" class="bad">Your score is bad.</div>
        <!-- <div>Your score is: {{result_you.score | number : '1.2-2'}}% (0% is linked to misinformation, 50% is unverified, 100% is valid)</div> -->
        <div>This is how the URLs that you shared are classified</div>
        <ngx-charts-advanced-pie-chart label="URLs verified" [view]="[1000,200]" [scheme]="colorScheme" [results]="pie_data_you"
          [gradient]="gradient">
        </ngx-charts-advanced-pie-chart>
      </div>
    </mat-card>
    <p></p>
    <div *ngIf="!error_you && !loading_you">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title class="bad">
            <i class="material-icons md-24">error</i>These tweets have been identified as linked to misinformation
          </mat-panel-title>
          <mat-panel-description>
            Click to expand
          </mat-panel-description>
        </mat-expansion-panel-header>

        <p>The URLs may have been fact-checked or come from domains that typically share false content.</p>

        <app-table-tweets [data]="table_data_bad"></app-table-tweets>

      </mat-expansion-panel>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title class="mixed">
            <i class="material-icons md-24">error</i>These tweets have been identified as linked to not completely true content
          </mat-panel-title>
          <mat-panel-description>
            Click to expand
          </mat-panel-description>
        </mat-expansion-panel-header>

        <p>The URLs may have been fact-checked and TODO.</p>

        <app-table-tweets [data]="table_data_mixed"></app-table-tweets>

      </mat-expansion-panel>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title class="good">
            <i class="material-icons md-24">check_circle</i>These tweets have been identified as linked to verified
            content
          </mat-panel-title>
          <mat-panel-description>
            Click to expand
          </mat-panel-description>
        </mat-expansion-panel-header>

        <p>The URLs may have been fact-checked or come from domains that typically share verified content.</p>

        <app-table-tweets [data]="table_data_good"></app-table-tweets>

      </mat-expansion-panel>
      <!-- <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <i class="material-icons md-24">info</i>These tweets have been identified as linked to controversial
            content
          </mat-panel-title>
          <mat-panel-description>
            Click to expand
          </mat-panel-description>
        </mat-expansion-panel-header>

        <p>For these URLs we cannot assert their truthiness but some of our datasets suggest different points of view
          so that you get a more complete idea of the problems discussed.</p>

        <app-table-tweets [data]="table_data_rebuttals"></app-table-tweets>


      </mat-expansion-panel> -->
    </div>
  </div>
  <p></p>
  <mat-card *ngIf="!loading_overall && !error_overall && !loading_you && !error_you && show_you">
    <div>
      <h3>You against the average user</h3>
      <div>The comparison between your score and the average user score</div>
      <ngx-charts-bar-horizontal-normalized [view]="[1000,150]" [scheme]="colorScheme" [results]="you_vs_average_multi"
        legend="true" xAxis="true" showDataLabel="true" yAxis="true" showXAxisLabel="true" xAxisLabel="URLs shared"></ngx-charts-bar-horizontal-normalized>
      <ngx-charts-bar-horizontal [view]="[1000,150]" [scheme]="colorScheme" [results]="you_vs_average" xScaleMax="100"
        xAxis="true" showDataLabel="true" yAxis="true" showXAxisLabel="true" xAxisLabel="Score" [xAxisTicks]="[0, 25, 50, 75, 100]"></ngx-charts-bar-horizontal>
      <div style="height: 200px;"></div>
      <div>
        <p *ngIf="result_you.score < result_overall.score" class="bad"><i class="material-icons md-48">error</i> You
          have spread more misinformation than the average of our users</p>
        <p *ngIf="result_you.score > result_overall.score" class="good"><i class="material-icons md-24">check_circle</i>
          You have spread less misinformation than the average of our users</p>
      </div>
    </div>
  </mat-card>
  <p></p>
  <mat-card *ngIf="!loading_you && !error_you && show_you">
    <div>
      <h3>Your twitter friends network</h3>
      <p>Your Twitter feed is built with tweets that come from people that you are following. For this reason this tool
        can analyse the profiles that you are following.</p>
      <p>You have {{friends_count || "..."}} friends<span *ngIf="friends_analysis_show">,
          {{result_friends.twitter_profiles_cnt}} of them have already been analysed.</span></p>
      <mat-spinner *ngIf="loading_friends" class="center"></mat-spinner>
      <div *ngIf="friends_analysis_show">
        <mat-progress-bar [value]="result_friends.twitter_profiles_cnt / friends_count * 100"></mat-progress-bar>
        <p></p>
        <button mat-button mat-raised-button color="accent" [disabled]="analyse_remaining_disabled" (click)="analyse_remaining()">Analyse
          remaining</button>
        <ngx-charts-force-directed-graph
          class="chart-container"
          [legend]="false"
          [links]="friends_graph.links"
          [animations]="true"
          (legendLabelClick)="onLegendLabelClick($event)"
          [nodes]="friends_graph.nodes"
          [scheme]="colorScheme"
          [view]="[1000,500]"
          [tooltipDisabled]="false"
          (select)="select_node($event)"
          [force]="graph_force"
          [forceLink]="graph_force_link">
          <ng-template #nodeTemplate let-node>
            <svg [attr.width]="node.options.size * 2" [attr.height]="node.options.size * 2">
              <defs>
                <pattern attr.id="{{'image' + node.value}}" patternUnits="userSpaceOnUse" [attr.height]="node.options.size * 2" [attr.width]="node.options.size * 2">
                  <image [attr.height]="node.options.size * 2" [attr.width]="node.options.size * 2" attr.xlink:href="{{node.options.image}}"></image>
                </pattern>
              </defs>
              <circle [attr.cx]="node.options.size" [attr.cy]="node.options.size" [attr.r]="node.options.size" attr.fill="{{'url(#image'+node.value+')'}}" [attr.stroke]="node.options.stroke" stroke-width="20%" />
            </svg>
          </ng-template>
          <ng-template #linkTemplate let-link>
              <svg:line
              strokeWidth="1" class="edge"
              [attr.x1]="link.source.x"
              [attr.y1]="link.source.y"
              [attr.x2]="link.target.x"
              [attr.y2]="link.target.y"
              [attr.stroke]="link.options.color" attr.transform="translate({{friends_graph.overall_move_x}}, {{friends_graph.overall_move_y}})"
            />
          </ng-template>
        </ngx-charts-force-directed-graph>
        <ngx-charts-advanced-pie-chart label="URLs verified from your friends" [view]="[1000,200]" [scheme]="colorScheme"
          [results]="pie_data_friends" [gradient]="gradient"></ngx-charts-advanced-pie-chart>
      </div>
      <div style="height: 500px;"></div>
      <!-- <div *ngIf="best_friend">
        <h4>Your best-scoring friend</h4>
        <div><a href="https://twitter.com/{{best_friend.screen_name}}" target="_blank">{{best_friend.screen_name}}</a> with a <a [routerLink]="['/analyse', best_friend.screen_name]">score of {{best_friend.score}}</a></div>
        <ngx-charts-advanced-pie-chart label="URLs verified from {{best_friend.screen_name}}" [view]="[1000,200]"
          [scheme]="colorScheme" [results]="best_friend_pie_data" [gradient]="gradient"></ngx-charts-advanced-pie-chart>
      </div> -->
      <div *ngIf="worst_friend">
        <h4>Your worst-scoring friend</h4>
        <div><a href="https://twitter.com/{{worst_friend.screen_name}}" target="_blank">{{worst_friend.screen_name}}</a> with a score of <a [routerLink]="['/analyse', worst_friend.screen_name]">score of {{worst_friend.score | number : '1.2-2'}}</a></div>
        <ngx-charts-advanced-pie-chart label="URLs verified from {{worst_friend.screen_name}}" [view]="[1000,200]"
          [scheme]="colorScheme" [results]="worst_friend_pie_data" [gradient]="gradient"></ngx-charts-advanced-pie-chart>
      </div>
    </div>
  </mat-card>
  <p></p>
  <mat-card>
    <mat-spinner *ngIf="loading_overall && !result_friends" class="center"></mat-spinner>
    <div *ngIf="error_overall">Error! Something is wrong in the communication with the backend!</div>
    <div *ngIf="!error_overall && (result_friends || !loading_overall)">
      <h3>How our assessment works</h3>
      <div>
        <p>We look at your Twitter profile. For those tweets with URLs, we verify whether they have been already
          detected as misinformation by fact-checkers/experts.</p>
        <p>So far we have analysed {{result_overall.tweets_cnt}} tweets coming from
          {{result_overall.twitter_profiles_cnt}} Twitter profiles.</p>
      </div>
      <ngx-charts-advanced-pie-chart label="URLs verified" [view]="[1000,200]" [scheme]="colorScheme" [results]="pie_data_overall"
        [gradient]="gradient"></ngx-charts-advanced-pie-chart>
      <p><a [routerLink]="['/about']">More about our verification process</a></p>
    </div>
  </mat-card>
</div>